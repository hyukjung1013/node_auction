<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no"/>
    <link rel="stylesheet" href="/css/room.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/event-source-polyfill/0.0.9/eventsource.min.js"></script>
</head> 
<body>
    <div id="container">
        <div class="wrapper" id="profile">
            <div>Hello! Ronaldo</div>
            <div>Deposit: 4000000won</div>
            <a href="/" id="home-btn" class="btn">뒤로 가기</a>
        </div>

        <div class="wrapper" id="product">
            <div id="title">입찰하기</div>
            <table id="table">
                <tr>
                    <th>PRODUCT</th>
                    <td><%=good.dataValues.name%></td>
                </tr>
                <tr>
                    <th>AUTHOR</th>
                    <td><%=nickname%></td>
                </tr>
                <tr>
                    <th>STARTING PRICE</th>
                    <td><%=good.dataValues.price%></td>
                </tr>
            </table>
            <img id="img" src="/uploads/<%=good.dataValues.img%>"/>
        </div>

        <div class="wrapper" id="bid">
            <div class="bid-wrapper">
                <div id="time"> 
                    <div>남은 시간</div>
                    <div id="time-value" data-start="<%=good.dataValues.createdAt%>">00:00:00</div>
                </div>
                <div id="chat-wrapper">
                    <div class="bid-info">
                        <div class="user">RONALDO: </div>
                        <div class="dollar"><span style="color: rgb(255, 0, 98); font-weight: bold;">100</span> dollars</div>
                        <div class="message">[I want to get it.]</div>
                    </div>
                    <div class="bid-info">
                        <div class="user">RONALDO: </div>
                        <div class="dollar"><span style="color: rgb(255, 0, 98); font-weight: bold;">100</span> dollars</div>
                        <div class="message">[I want to get it.]</div>
                    </div>
                    <div class="bid-info">
                        <div class="user">RONALDO: </div>
                        <div class="dollar"><span style="color: rgb(255, 0, 98); font-weight: bold;">100</span> dollars</div>
                        <div class="message">[I want to get it.]</div>
                    </div>
                </div>
            </div>
            <div class="bid-wrapper">
                <input class="input" id="price" type="text" placeholder="price"/>
                <input class="input" id="comment" type="text" placeholder="comment"/>
                <button class='btn'>bid</button>
            </div>
        </div>
    </div>

    <script>
        var sse = new EventSource('/sse');
        sse.onmessage = function(event) {
            var td = document.querySelector('#time-value');
            var end = new Date(td.dataset.start);
            var server = new Date(parseInt(event.data, 10));
            end.setDate(end.getDate() + 1);
            if (server >= end) {
                td.innerHTML = '00:00:00'; 
            } else { 
                var time = end - server;
                var seconds = ('0' + Math.floor((time/1000) % 60)).slice(-2);
                var minutes = ('0' + Math.floor((time/1000/60) % 60)).slice(-2);
                var hours = ('0' + Math.floor((time/(1000*60*60)) % 24)).slice(-2);
                td.innerHTML = `${hours}:${minutes}:${seconds}`;
            }
        }
    </script>
</body>